!function(){"use strict";var e=self.console,n=Object.freeze({NONE:0,ERROR:1,WARN:2,INFO:3,LOG:4}),t=["error","warn","info","log"],i=window.Rollbar&&window.Rollbar.options.enabled,o={debug:["critical","error","warn","debug","log"],info:["critical","error","warn","info"],warning:["critical","error","warn"],error:["critical","error"],critical:["critical"]},r=void 0!==e&&void 0!==e.log&&void 0!==e.error&&void 0!==e.debug&&void 0!==e.warn&&"function"==typeof Function.prototype.apply,a=void 0,l=void 0,d=function(n,t,i,o){return e[t]?i?e[t](i):e[t]():n.log("----------- "+(i||o)+" ----------- ")},u=function(n){var l=n.level,u={setLevel:function(e){return l=e,u},getLevel:function(){return l||a}};return t.forEach(function(n){u[n]=function(){for(var a=arguments.length,l=Array(a),d=0;d<a;d++)l[d]=arguments[d];return function(n,a,l){if(r){var d,u=t.indexOf(a),c=n.getLevel();return~u&&c>=u+1&&e[a].apply(e,l),i&&~o[window.Rollbar.options.reportLevel].indexOf(a)&&(d=window.Rollbar)[a].apply(d,l),n}}(u,n,l)}}),u.groupCollapsed=function(e){return d(u,"groupCollapsed",e,"GROUP START")},u.group=function(e){return d(u,"group",e,"GROUP START")},u.groupEnd=function(){return d(u,"groupEnd",null,"GROUP END")},u.devError=function(){"production"!==process.env.NODE_ENV&&u.error.apply(u,arguments)},u.debug=u.log,u},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.level=e.level||n.NONE;var t=e.newInstance||!l?u(e):l;return l||e.newInstance||(l=t),t},s={LOCAL:"local",URL:"url",CAMERA:"camera",IMAGE_SEARCH:"image_search",DROPBOX:"dropbox",FACEBOOK:"facebook",INSTAGRAM:"instagram"},f="upload-finish",p="widget-view-change",g="display-changed",v="uw_init",h="uw_mini",m="uw_config",y="uw_prepare",w="uw_prebatch",b="uw_event",x="uw_show",E="uw_hide",C="uw_tags",O="uw_upload_presets",k="uw_file",S=["buttonCaption","buttonClass","queueViewPosition","controlVpMeta","fieldName","frameZIndex","widgetHost"],_="initial",N="expanded",R="minimized",W=function(e,n,t,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=(o=o||self).document.createElement(e);if(n=n||{},t&&(n.class=t),n){var a=n;Object.keys(a).forEach(function(e){return r.setAttribute(e,a[e])})}if(i){var l=i;Object.keys(l).forEach(function(e){return r.dataset[e]=l[e]})}return r},L=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n=n||self,"string"==typeof e?n.document.querySelector(e):e},M=function(e){e.parentNode&&e.parentNode.removeChild(e)},P=function(e,n){Object.keys(n).forEach(function(t){e.style[t]=n[t]})},U=function(e){P(e,{display:"none"})},I="FileReader"in self&&"FileList"in self&&"Blob"in self,T=function(e){return"string"==typeof e},j=function(e){return"function"==typeof e},A=function(e,n){var t=null;if(e.closest)t=e.closest(n);else{var i=self.document.querySelectorAll(n);i&&i.length&&(t=Array.prototype.find.call(i,function(n){return t=e,!!(n.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY);var t}))}return t},F=500,z=55,D="right:35px",H="(min-width: 767px)",q=610,V="hidden",B="shown",G=c(),$=function(e,n,t){var i,o,r=/cloudinary\.com/;G.log("[all.comms]: using pm domain regex =  "+r.toString());var a=function(e,n){t.widgetCallback&&t.widgetCallback(n,e)},l=function(e){var n=void 0;try{T(e)&&(n=JSON.parse(e))}catch(n){G.log("[all.comms]: failed to deserialize message: ",e)}return n},d=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?{type:e,data:n}:function(e,n){return JSON.stringify({type:e,data:n})}(e,n);t.postMessage(i)},u=function(e){a({info:e,event:g,uw_event:!0,data:{event:g,info:e}})},c=((i={})[p]=function(e){t.handleWidgetViewTypeChange(e.info);var n=e.info.type===R?R:N;u(n)},i[f]=function(e,n){if(G.log("[all.comms]: received uploaded file data - ",e),e.info.failed)n.inlineMode&&a(null,e.info),t.triggerEvent("cloudinarywidgetfileuploadfail",[e.info]);else{var i=e.info.uploadInfo,o={event:"success",info:i};t.processUploadResult(i),a(o),t.triggerEvent("cloudinarywidgetfileuploadsuccess",o)}},i),s=((o={})[b]=function(e,n){e.event&&c[e.event]?c[e.event](e,n):a({info:e.info,event:e.event,uw_event:!0,data:e})},o[E]=function(){t.hideWidget();var e={event:"close",info:{message:"user closed the widget"}};a(e),t.triggerEvent("cloudinarywidgetclosed",e),u(V)},o[y]=function(e,n){var t=function(e){return d(y,e)},i=n.prepareUploadParams||n.uploadSignature;"function"==typeof i?i(function(e){G.log("[all.comms]: received prepared data from client: ",e);var n=[].concat(e).map(function(e){return"string"==typeof e?{signature:e}:e});t(n)},e.request):"string"==typeof n.uploadSignature&&t([{signature:n.uploadSignature}])},o[w]=function(e,n){if("function"!=typeof n.preBatch)throw new Error("UploadWidget - preBatch handler not found!");n.preBatch(function(e){G.log("[all.comms]: received pre-batch data from client: ",e),d(w,e)},e.request)},o[C]=function(e,n){n.getTags(function(e){G.log("[all.comms]: received tags from client: ",e),d(C,{tags:e})},e.prefix)},o[O]=function(e,n){n.getUploadPresets(function(e){G.log("[all.comms]: received uploadPresets from client: ",e),d(O,{uploadPresets:e})})},o);return window.addEventListener("message",function(n){var t=e();if(n.origin.match(r)){var i=l(n.data),o=!1;i&&i.widgetId&&i.widgetId===t.widgetId&&(G.log("[all.comms]: received message from widget: "+t.widgetId,i),s[i.type]&&(o=!0,s[i.type](i,t))),o||G.log("[all.comms]: received invalid message, invalid widget ID or invalid type! ",n.data)}}),{sendMessage:d,sendDisplayChangedCallback:u}},J=/(left|right)(?::([0-9a-z]*))?$/,K=function(e,n,t){var i=e(),o={raw:D,side:null,offset:null},r=W("iframe",{frameborder:"no",allow:"camera",width:"100%",height:"100%"},null,{test:"uw-iframe"});P(r,{border:"none",background:"transparent"});var a=window.matchMedia(H),l=i.inlineContainer&&L(i.inlineContainer),d=i.frameContainer&&L(i.frameContainer);l&&P(l,{minHeight:q+"px",overflowX:"hidden"}),d&&P(d,{position:"relative"});var u=null,c=!1,s="",f=!1,p=!1,g=!1,v=!1,h=void 0,m=function(e){e.preventDefault()},y=function(){if(!l&&!d){var n=g&&v;h.body&&(u=null===u?h.body.style.overflow:u,h.body.style.overflow=n?"hidden":u),function(e){e?h.addEventListener("touchmove",m):h.removeEventListener("touchmove",m)}(n),function(n){if(!0===e().controlVpMeta)if(n){var t=L('head meta[name="viewport"]',self.top);t||(t=W("meta",{name:"viewport"},null,null,self.top),h.head.appendChild(t)),t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}else{var i=L('head meta[name="viewport"]',self.top);c&&i?i.content=s:i&&h.head.removeChild(i)}}(n)}},w=function(){f&&p&&(U(r),g=!1,y())},b=function(){f&&p&&(P(r,{display:"block"}),g=!0,y(),r.focus())},x=function(){var e;e=r,(l||(d||void 0)||document.body).appendChild(e),l||h.addEventListener("keyup",function(e){27===e.keyCode&&w()})},E=function(n){var t=Math.min(F,window.innerWidth)+"px";P(r,{width:n?"100%":t,bottom:n?"0px":"5px",height:z+"px",top:""}),function(n){var t=e();if(t.queueViewPosition&&t.queueViewPosition!==o.raw||!o.side||!o.offset){o.raw=t.queueViewPosition||o.raw;var i=J.exec(o.raw);if(!i)throw new Error("queueViewPosition param ("+(t.queueViewPosition||"")+') is invalid. (valid ex: "right:35px")');o.side=i[1],o.offset=i[2]||"0"}var a=void 0;a=n?{left:"0px",right:"0px"}:"left"===o.side?{left:o.offset||"",right:""}:{right:o.offset||"",left:""},P(r,a)}(n),v=!1,y()},C=function(){P(r,l?{height:q+"px",width:"100%"}:{width:"100%",height:"100%",top:"0px",left:"0px",bottom:""}),v=f,y()},O=function(){b(),C()},k=function(e){E(!e.matches)},S=function(e){switch(a.removeListener(k),e.type){case _:case N:C();break;case R:E(!a.matches),a.addListener(k)}},M=function(e){return r.contentWindow.postMessage(e,n)},I=function(){return p},T=function(){return f},j=function(){return f&&g},A=function(){return T()&&!v},V=function(){w(),f=!1},B=function(e){f=!0,p&&(O(),e&&e.files&&U(r))},G=function(){f&&p&&!v&&E(!a.matches)},$=function e(){r.removeEventListener("load",e),p=!0,t({open:B,close:V,showWidget:b,hideWidget:w,isFrameReady:I,isWidgetOpen:T,isWidgetMinimized:A,isWidgetShowing:j,postMessage:M,handleWidgetViewTypeChange:S,optionsUpdated:G}),O()};!function(t){h=function(){var e=self.document;try{e=self.top.document}catch(e){}return e}();var i=function(e){var n=[];return e.debug&&n.push("debug=true"),e.dev&&n.push("dev=true"),e.cloudName&&n.push("cloudName="+e.cloudName),n.push("pmHost="+self.location.protocol+"//"+self.location.host),n}(t),o=n+"?"+i.join("&");r.setAttribute("src",o),U(r),P(r,{position:l?null:d?"absolute":"fixed",zIndex:l?null:t.frameZIndex||"1000000"}),r.addEventListener("load",$),function(){if(!0===e().controlVpMeta){var n=L('head meta[name="viewport"]',self.top);n&&(s=n.content,c=!0)}}(),x()}(i)},X="fetch"in self,Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Y=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",t=arguments[2],i=arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=t&&"object"===(void 0===t?"undefined":Q(t))?JSON.stringify(t):t,a=X;return(a?self.fetch(e,Z({method:n,body:r,headers:i?new Headers(i):void 0},o.fetchOptions)):new Promise(function(t,a){var l=new XMLHttpRequest;l.open(n,e),o.responseType&&(l.responseType=o.responseType),l.onerror=function(){return a(l)},l.ontimeout=function(){return a(l)},l.onload=function(){return t(l)},function(e,n){if(n){var t=n;Object.keys(t).forEach(function(n){return e.setRequestHeader(n,t[n])})}}(l,i),l.send(r)})).then(function(e,n,t){var i=n.responseType,o=function(e){return t.response=e,t};return!n.dontRead&&e&&t.ok?i&&t[i]?t[i]().then(o):t.json().then(o):t}.bind(null,a,o))},ee=c(),ne="cloudinary-button",te="cloudinary-thumbnails",ie="cloudinary-thumbnail",oe="cloudinary-delete",re=function(e){return e.fieldName||"image"},ae=function(e,n){var t=n.form;return!t&&e&&(t=A(e,"form")),t},le=function(e,n,t){var i=ae(n,t);i&&(i=L(i))&&function(e,n,t){var i=W("input",{type:"hidden",name:re(t)},null,{cloudinaryPublicId:e.public_id});i.value=[e.resource_type,e.type,e.path].join("/")+"#"+e.signature;try{i.dataset.cloudinary=JSON.stringify(e)}catch(e){ee.error("[all.pageIntegrations]: failed to add info as serialized data attribute")}n.appendChild(i)}(e,i,t)},de=function(e,n,t,i,o,r){e.addEventListener("click",function a(l){var d=function(e){return e.deleteHost?e.deleteHost:"https://api"+(e.dev?"-dev":e.staging?"-staging":"")+".cloudinary.com"}(o)+"/v1_1/"+o.cloudName+"/delete_by_token";return ee.log("[all.pageIntegrations]: \n        about to send delete request with token: "+i.delete_token+" to : "+d),l.preventDefault(),Y(d,"POST",{token:i.delete_token},{"Content-Type":"application/json"},{dontRead:!0}).then(function(l){200===l.status&&(ee.log("[all.pageIntegrations]: successfully deleted file"),e.removeEventListener("click",a),function(e,n,t,i){M(e);var o=ae(n,i);if(o){var r=o.querySelector('input[name="'+re(i)+'"][data-cloudinary-public-id="'+t.public_id+'"]');r&&M(r)}}(n,t,i,o),r.triggerEvent("cloudinarywidgetdeleted",i))}).catch(function(e){ee.warn("[all.pageIntegrations]: failed to delete file with status: "+e.status)})})},ue=function(e,n,t,i){if(!1!==t.thumbnails&&(t.thumbnails||n)){var o=!0,r=L("."+te);if(r||(o=!1,r=W("ul",null,te)),r.appendChild(function(e,n,t,i){var o=W("li",null,ie,{cloudinary:JSON.stringify(e)}),r=void 0;e.thumbnail_url?(r=W("img",{src:e.thumbnail_url})).addEventListener("load",function e(){o.classList.add("active"),r.removeEventListener("load",e)}):(r=W("span")).textContent=e.public_id;if(o.appendChild(r),e.delete_token){var a=W("a",{href:"#"},oe);a.textContent="x",o.appendChild(a),de(a,o,n,e,t,i)}return o}(e,n,t,i)),!o){ee.log("[all.pageIntegrations]: adding thumbnails list to dom");var a=t.thumbnails&&L(t.thumbnails);a?a.appendChild(r):n&&n.insertAdjacentElement("afterend",r)}}},ce=function(e,n){return 0===n?e:e.substr(0,1).toUpperCase()+e.substr(1)},se=function(e){return Object.keys(e).reduce(function(n,t){return n[t.indexOf("_")>0?function(e){return e.split("_").map(ce).join("")}(t):t]=e[t],n},{})},fe=["keepWidgetOpen","stylesheet"],pe=Object.prototype.toString,ge=function(e){return fe.forEach(function(n){void 0!==e[n]&&function(){var e;(e=console).warn.apply(e,arguments)}("Cloudinary.UploadWidget - '"+n+"' is no longer used in this version.")})},ve=function(e){return e?se(e):{}},he=c(),me=c(),ye=function(e){var n=null,t=function(n){var t=n.file,i=n.result,o=n.index,r=n.count;e.sendMessage(k,{lastModified:t.lastModified,lastModifiedDate:t.lastModifiedDate,name:t.name,size:t.size,type:t.type,file:i,index:o,count:r},!0)},i=function(e,i,o,r){var a,l,d,u,c,s,f,p=void 0;return!r.maxFileSize||r.maxFileSize>0&&e.size<=r.maxFileSize?(n||(a=[],l=new FileReader,d=null,u=function(){d&&d.readResolve({file:d.file,index:d.index,count:d.count,result:l.result}),c()},c=function(){d=null,l.removeEventListener("load",u,!1),l.removeEventListener("error",s,!1),a.length&&f(a.shift())},s=function(){he.log("[utils.fileReader]: failed to read file",l.error),d&&d.readReject(l.error),c()},f=function(e){d=e,l.addEventListener("load",u,!1),l.addEventListener("error",s,!1),l.readAsDataURL(e.file)},n={read:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise(function(i,o){var r={file:e,index:n,count:t,readResolve:i,readReject:o};1!==l.readyState?f(r):a.push(r)})}}),p=n.read(e,i,o).then(t).catch(function(n){me.error("[global.all.uploadsHandler]: failed to send file data to widget for upload",n.code,e)})):me.log("[global.all.uploadsHandler]: provided file is larger than max file size configured",e.size),p},o=function(n,t){return Promise.race(Array.prototype.map.call(n,function(o,r){var a,l=null;return a=o,I&&(a instanceof File||"[object File]"===a.toString())?l=i(o,r,n.length,t):T(o)?e.sendMessage(k,{file:o,index:r,count:n.length}):me.warn("[global.all.uploadsHandler]: unknown type of object sent to upload",o),l}))};return{handleFiles:function(e,n){return e&&e.files?o(e.files,n):Promise.resolve()}}},we=c(),be=0,xe=function(e,n){var t=function(e,n){if(e=e||{},"[object Object]"!==pe.call(e))throw new Error("[Cloudinary.UploadWidget]: widget options must be a valid Object");var t=ve(e);return t.secure=!1!==t.secure,t.requirePrepareParams=!!t.prepareUploadParams||!!t.uploadSignature,t.useTagsCallback=j(t.getTags),t.useUploadPresetsCallback=j(t.getUploadPresets),t.usePreBatchCallback=j(t.preBatch),t.inlineMode=!!t.inlineContainer,t.fieldName=e.fieldName||n&&n.getAttribute("name")||null,ge(t),t}(e,n);return be+=1,t.widgetId="widget_"+be,t},Ee=function(e,n,t){t=function(e,n){var t=e||n&&n.element;if(t){try{t=L(t)}catch(e){throw new Error("[Cloudinary.UploadWidget]: 'element' param must either be a valid HTMLElement or a selector string")}if(!t||!t.nodeType)throw new Error("[Cloudinary.UploadWidget]: 'element' param must resolve to a valid HTMLElement")}return t}(t,e);var i=xe(e,t);if(i.inlineContainer&&!L(i.inlineContainer))throw new Error("[Cloudinary.UploadWidget]: 'inlineContainer' param must either be a valid HTMLElement or a selector string");delete i.element;var o,r=void 0,a=void 0,l=void 0,d=void 0,u=void 0,c=function(e,n){i.$&&i.$(t||i.form||document).trigger(e,n)},s=function(e){return r?r.then(e).catch(function(e){return we.error("Cloudinary.UploadWidget - encountered error ! ",e)}):we.error("Cloudinary.UploadWidget - Widget frame API not ready yet!")},f=function(e,n){return s(function(t){t.open(n),t.isFrameReady()&&(a.sendMessage(x,{source:e,options:n},!0),l.handleFiles(n,g()).then(function(){setTimeout(function(){t.showWidget(),a.sendDisplayChangedCallback(B)},150)}))})},p=function(e){return s(function(n){var t,o,r=ve(e);a.sendMessage(m,r),t=r,o=Z({},i),S.forEach(function(e){void 0!==t[e]&&(o[e]=t[e])}),i=o,n.optionsUpdated()})},g=function(){return i};return o=function(){var e=i.secure?"https:":"http:",n=void 0;if(!0===i.dev)n="//widget-dev.cloudinary.com/index.html";else{var t=(i.widgetBase||"//widget"+(!0===i.staging?"-staging":"")+".cloudinary.com/")+"v2.0/n/";n=i.widgetHost||t+i.cloudName+"/"+i.widgetVersion+"/index.html"}return n=0!==n.indexOf("http")?e+n:n}(),(r=function(e,n){return new Promise(K.bind(null,e,n))}(g,o)).then(function(e){d=e.isWidgetShowing,u=e.isWidgetMinimized,a=$(g,0,Z({triggerEvent:c,processUploadResult:function(e){return function(e,n,t,i){le(e,n,t),ue(e,n,t,i)}(e,t,g(),{triggerEvent:c})},widgetCallback:n},e));var i=g();a.sendMessage(v,Z({},i,{showOnStart:e.isWidgetOpen()})),l=ye(a),t&&function(e,n,t){var i=W("a",{href:"#"},t.buttonClass||ne);i.innerHTML=t.buttonCaption||"Upload image",e.style.display="none",e.parentNode&&e.parentNode.insertBefore(i,e.previousSibling),i.addEventListener("click",function(e){return n(),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1})}(t,f,i)}),{open:function(e,n){return f(e,n),this},update:function(e){var n=this;return p(e).then(function(){return n})},close:function(e){return function(e){s(function(n){n.close(),a.sendMessage(E,e)})}(e),this},hide:function(){return s(function(e){return e.hideWidget()}),this},show:function(){return s(function(e){return e.showWidget()}),this},minimize:function(){return s(function(){a.sendMessage(h)}),this},isShowing:function(){return!!d&&d()},isMinimized:function(){return!!u&&u()}}},Ce=c();!function(e){var t,i={cloudName:null,apiKey:null},o=e.jQuery?e.jQuery:e.$&&e.$.fn&&e.$.fn.jquery?e.$:null,r=e.location.search.indexOf("debug=true")>-1,l=e.location.search.indexOf("dev=true")>-1;t=r?n.LOG:n.WARN,a=t,function(){try{var e=W("style",{id:"cloudinary-uw-page-styles",type:"text/css"});e.innerHTML=".cloudinary-thumbnails { list-style: none; margin: 10px 0; padding: 0 }\n        .cloudinary-thumbnails:after { clear: both; display: block; content: '' }\n        .cloudinary-thumbnail { float: left; padding: 0; margin: 0 15px 5px 0; display: none } \n        .cloudinary-thumbnail.active { display: block } \n        .cloudinary-thumbnail img { border: 1px solid #01304d; border-radius: 2px; -moz-border-radius: 2px; -webkit-border-radius: 2px } \n        .cloudinary-thumbnail span { font-size: 11px; font-family: Arial, sans-serif; line-height: 14px; border: 1px solid #aaa; max-width: 150px; word-wrap: break-word; word-break: break-all; display: inline-block; padding: 3px; max-height: 60px; overflow: hidden; color: #999; } \n        .cloudinary-delete { vertical-align: top; font-size: 13px; text-decoration: none; padding-left: 2px; line-height: 8px; font-family: Arial, sans-serif; color: #01304d }\n        .cloudinary-button { background-color: #0078FF; color: #FFFFFF; text-decoration: none; font-size: 14px; line-height: 28px; height: 28x; cursor: pointer; font-weight: normal; display: inline-block; border-radius: 4px; padding: 10px 14px;}\n        .cloudinary-button:hover {-webkit-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .5); box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .5); } ";var n=L("head");n&&n.appendChild(e)}catch(e){Ce.error("[all.pageStyles]: failed to apply styles")}}();var d=e.cloudinary=e.cloudinary||{};d.applyUploadWidget=function(e,n,t){return Ee(function(e){return Z({},i,{dev:l,debug:r},e,{widgetVersion:"157",$:o})}(n),t,e)},d.createUploadWidget=function(e,n){return d.applyUploadWidget(null,e,n)},d.openUploadWidget=function(e,n){return d.createUploadWidget(e,n).open()},d.setCloudName=function(e){i.cloudName=e},d.setAPIKey=function(e){i.apiKey=e},d.WIDGET_SOURCES=Z({},s),d.WIDGET_VERSION="157",o&&(o.fn.cloudinary_upload_widget=function(e,n){d.applyUploadWidget(o(this)[0],e,n)})}(self)}();
